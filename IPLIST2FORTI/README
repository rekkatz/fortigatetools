REFERENCE: https://www.beneicke-edv.de/support/tools/

Use case: you have a list of IP addresses and want to import them into your Fortigate, and use them in a policy to block or allow traffic from or to these hosts (blacklist or whitelist).

Such a list can for instance be generated by hosts.deny.

The following script takes a text file with IP addresses and converts it to a FortiOS batch command file, ready to be imported as a ‘bulk command’ (System > Advanced > Configuration Scripts).

To circumvent certain object size limits the script has to

    parse the input for IP addresses and add them to an internal list
    for each IP address, create a FOS address object
    for each 100 addresses, create a FOS address group
    create one or more FOS ‘super’ address group(s) (group of groups)

As the script cannot read the ‘live’ configuration from the FGT it will create a ‘purge’ batchfile to delete the imported address objects before importing new addresses.

usage: iplist2forti.py [-h] [-m {s,m,l}] [-n MAXADDR] [-p PREVADDR] [-d] [-D]
 [-o CMDFNAME] [-s SPLITCOUNT]
 infile
 Create (a lot of) address objects and groups from list for use in FortiOS.

positional arguments:
 infile                read IPs from <infile>

optional arguments:
 -h, --help            show this help message and exit
 -m {s,m,l}, --model {s,m,l}
                       FortiGate model: small (<FGT-100) / medium (<FGT-1000)
                       / large
 -n MAXADDR, --newest MAXADDR
                       use only newest/last <maxAddr> addresses from list
 -p PREVADDR, --prev PREVADDR
                       replace <prevAddr> old addresses
 -d, --dontresolve     skip non-numeric addresses (FQDNs) in input
 -D, --debug           print debug output
 -o CMDFNAME, --outfile CMDFNAME
                       write output to <cmdfname>
 -s SPLITCOUNT, --split SPLITCOUNT
                       split output into <splitcount> parts
expected output:

iplist2forti.py -ms -p 0 -d -o out.txt hosts.deny

bulk commandfile created: out_2017-03-14_1935.txt
 specific for small Fortigate model
 4054 IPs in file
 1554 IPs skipped
 2500 IPs in 125 address groups of size 20
 125 address groups in 1 super group of size 125

apply bulk command file out_2017-03-14_1935.txt
 refer to address group "sblockgroups000" in DENY policy
 to get rid of these addresses, apply out_purge_2017-03-14_1935.txt